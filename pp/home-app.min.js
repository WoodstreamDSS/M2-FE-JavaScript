require(["jquery"],(function($){let index=0,newIndex,maxIndex=$("#home-app>section").length,direction,animating=!1,processingScroll=!1,gyroscope=new Gyroscope({frequency:60});console.log(`Gyroscope available: ${gyroscope.activated}`);const videoStateUpdate=state=>{state?$('#home-app>section[data-index="0"] video')[0].play():$('#home-app>section[data-index="0"] video')[0].pause()};let displayMode;const findMaxPanelSize=()=>{let desiredMargin=.05,portraitByWidth=1.7,portraitByHeight=.58,landscapeByWidth=.48,landscapeByHeight=2.05,resizeMode,headerHeight=$(".section-heading").innerHeight(),vpWidth,vpHeight,vpAR=window.innerWidth/(window.innerHeight-headerHeight);const resizePanel=()=>{let newHeight,newWidth,newTop,newLeft;"height"==resizeMode&&(newHeight=window.innerHeight-headerHeight,newHeight-=.05*newHeight*2,newWidth="portrait"==displayMode?.58*newHeight:2.05*newHeight),"width"==resizeMode&&(newWidth=window.innerWidth,newWidth-=.05*newWidth*2,newHeight="portrait"==displayMode?1.7*newWidth:.48*newWidth),newTop=headerHeight+.05*newHeight,newLeft=(window.innerWidth-newWidth)/2;let dim={height:newHeight,width:newWidth,top:newTop,left:newLeft,"font-size":newHeight/100+"px"};$(".panel-resize").css(dim)};"portrait"==displayMode&&(resizeMode=vpAR<.58?"width":"height"),"landscape"==displayMode&&(resizeMode=vpAR>2.05?"height":"width"),resizePanel()},updateDisplayMode=()=>{let height=window.innerHeight,width=window.innerWidth,ar;$("body").css("height",window.innerHeight),displayMode=height/width>.8?"portrait":"landscape",$("#home-app>section, .lc-content, .bl-content").removeClass("portrait landscape").addClass(displayMode),findMaxPanelSize()},updateDisplayModeDebounce=new woodstream.Debounce(updateDisplayMode,200);$(window).on("resize",updateDisplayModeDebounce),updateDisplayMode();const updateSection=()=>{let fade=500;index>0?($(".home-header").fadeOut(500),$(".section-heading").fadeIn(500)):($(".home-header").fadeIn(500),$(".section-heading").fadeOut(500)),index>0&&index<4&&($(".section-heading h2.learning-center").show(),$(".section-heading h2.bird-library").hide()),index>=4&&($(".section-heading h2.learning-center").hide(),$(".section-heading h2.bird-library").show()),index>=7&&$(".section-heading").hide(),0==index&&"on"==$(".lc-content").attr("data-mode")&&$(".lc-content").fadeOut(500).attr("data-mode","off"),index>0&&index<4&&("on"==$(".bl-content").attr("data-mode")&&$(".bl-content").fadeOut(500).attr("data-mode","off"),"off"==$(".lc-content").attr("data-mode")&&$(".lc-content").fadeIn(500).attr("data-mode","on")),index>3&&index<7&&("on"==$(".lc-content").attr("data-mode")&&$(".lc-content").fadeOut(500).attr("data-mode","off"),"off"==$(".bl-content").attr("data-mode")&&$(".bl-content").fadeIn(500).attr("data-mode","on")),index>6&&"on"==$(".bl-content").attr("data-mode")&&$(".bl-content").fadeOut(500).attr("data-mode","off")},scroll=direction=>{let footer=!1,dataState;direction>0?(8==newIndex&&7==index&&($("#home-app .flock").addClass("footer"),footer=!0),0!=newIndex&&videoStateUpdate(!1),dataState="up"):(7==newIndex&&8==index&&($("#home-app .flock").removeClass("footer"),footer=!0),0==newIndex&&videoStateUpdate(!0),dataState="down"),footer||($(`#home-app>section[data-index="${index}"]`).removeClass("on").addClass("off"),$(`#home-app>section[data-index="${newIndex}"]`).removeClass("off").addClass("on"),$(`#home-app>section[data-index="${index}"] .animated-object`).attr("data-state",dataState),$(`#home-app>section[data-index="${newIndex}"] .animated-object`).attr("data-state","on")),index=newIndex,updateLearningCenterIndicator(),updateBirdLibraryIndicator(),updateSection(),updateTabIndex()},scrollHandler=()=>{animating=!0,scroll(direction)},scrollDebounce=woodstream.Debounce(scrollHandler,250,!0),checkLoad=()=>{let loadIndex=newIndex;loadIndex++;let section=$(`#home-app>section[data-index="${loadIndex}"]`),state;if("false"==section.attr("data-loaded")){let images;section.attr("data-loaded","true"),section.find("img.lazy-load").each((function(){let newSource=$(this).attr("data-src");$(this).attr("src",newSource)}))}},scrollLogic=increment=>{processingScroll=!0;let scrolling=!0;newIndex=index,newIndex+=increment,checkLoad(),newIndex<0&&0==index&&(newIndex=0,scrolling=!1),newIndex<0&&0!=index&&(newIndex=0,scrolling=!0),newIndex>maxIndex&&index==maxIndex&&(newIndex=maxIndex,scrolling=!1),newIndex>maxIndex&&index!=maxIndex&&(newIndex=maxIndex,scrolling=!0),scrolling&&!animating?(direction=increment,scrollDebounce()):processingScroll=!1};$(document).on("keyup",e=>{"ArrowUp"==e.key&&scrollLogic(-1),"ArrowDown"==e.key&&scrollLogic(1)}),document.addEventListener("wheel",(function(e){if(!processingScroll&&!animating){let indexIncrement=0;indexIncrement=e.deltaY>0?1:-1,scrollLogic(indexIncrement)}}));const animationComplete=()=>{animating=!1,processingScroll=!1},postItemAnimation=woodstream.Debounce(animationComplete,250,!0);$("#home-app>section .animated-object").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",postItemAnimation);const updateLearningCenterIndicator=()=>{let panelCount=3,percentage=100/3*index;"landscape"==displayMode?$("#lc-indicator .percentage").css({height:`${percentage}%`,width:"100%"}):$("#lc-indicator .percentage").css({width:`${percentage}%`,height:"100%"}),0==index?$("#lc-indicator").fadeOut(500):$("#lc-indicator").fadeIn(500)},updateBirdLibraryIndicator=()=>{$("#bl-indicator .bird").attr("aria-selected","false"),$(`#bl-indicator .bird[data-index="${index}"]`).attr("aria-selected","true")};updateLearningCenterIndicator(),updateLearningCenterIndicatorDebounce=new woodstream.Debounce(updateLearningCenterIndicator,250),$(window).on("resize",updateLearningCenterIndicatorDebounce);const updateTabIndex=()=>{const links=$(".home-header a, .home-header button, #home-app a, #home-app button");links.attr("tabindex",-1),0==index&&$(".home-header a, .home-header button").attr("tabindex",0),index>=4&&index<=6&&$("#bl-indicator button, .bl-link").attr("tabindex",0),8==index&&$("footer .content a, footer .content button").attr("tabindex",0),$(`section[data-index="${index}"] a, section[data-index="${index}"] button`).attr("tabindex",0)};updateTabIndex(),woodstream.ParallaxObject=class{constructor(id,panel,maxMovement,weight){this.id=id,this.el=$(`#${id}`),this.panel=panel,this.weight=weight,this.maxMovement=maxMovement}move(obj){let xMove=-1*parseInt(obj.nX*this.maxMovement*this.weight),yMove=-1*parseInt(obj.nY*this.maxMovement*this.weight);$(this.el).css({transform:`translate(${xMove}px, ${yMove}px)`})}};let parallaxPanels=[];$("#home-app>section").each((function(i){let pObjects=$(this).find(".parallax-object");panelObjects=[],pObjects.each((function(j){let id=`id-${i}-${j}`;$(this).attr("id",id);let weight=parseFloat($(this).attr("data-weight"));panelObjects.push(new woodstream.ParallaxObject(id,i,40,weight))})),parallaxPanels.push(panelObjects)}));const parallaxHandler=(pageX,pageY)=>{let data={},xCenter=parseInt(window.innerWidth/2),yCenter=parseInt(window.innerHeight/2);data.deltaX=pageX-xCenter,data.deltaY=pageY-yCenter;let maxFromCenter=Math.sqrt(xCenter*xCenter+yCenter*yCenter);data.dist=parseInt(Math.sqrt(data.deltaX*data.deltaX+data.deltaY*data.deltaY)),data.nDist=data.dist/maxFromCenter,data.nX=data.deltaX/xCenter,data.nY=data.deltaY/yCenter;try{parallaxPanels[index].length>0&&parallaxPanels[index].forEach((function(obj){obj.move(data)}))}catch{}},parallaxHandlerDebounce=(x,y)=>{woodstream.Debounce(parallaxHandler(x,y),200)};document.onmousemove=e=>{parallaxHandlerDebounce(e.pageX,e.pageY)};const bodyScrollHandler=obj=>{if("end"==obj.status){let increment=0;obj.yMove>=25&&(increment=-1),obj.yMove<=-25&&(increment=1),0!=increment&&scrollLogic(increment)}};let docScroll=new woodstream.TouchObj("home-app",bodyScrollHandler);$("#bl-indicator .bird").on("click",(function(){let target=parseInt($(this).attr("data-index")),increment;scrollLogic(target-index)}))}));